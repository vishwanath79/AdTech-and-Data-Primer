
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Counting Impressions: Tags, Pixels, and Logs &#8212; AdTech for the data Professional</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '03-Measurement_Fundamentals/02-Counting_Impressions';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Messy Truth About Measuring ROI" href="03-Measurement_Challenges.html" />
    <link rel="prev" title="Why It’s Important to Measure (and Why It’s Harder Than You Think)" href="01-Importance_of_Measurement.html" />

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-044PFGMECV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-044PFGMECV');
</script>

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../00-Preface.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/adtech.png" class="logo__image only-light" alt="AdTech for the data Professional - Home"/>
    <script>document.write(`<img src="../_static/adtech.png" class="logo__image only-dark" alt="AdTech for the data Professional - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 1 - Foundations of Digital Advertising &amp; Measurement</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../About.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-Introduction/index.html">Introduction</a></li>


<li class="toctree-l1 has-children"><a class="reference internal" href="../02-Core_Concepts/index.html">Chapter 2: Core Concepts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../02-Core_Concepts/01-What_is_AdTech.html">What is AdTech?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02-Core_Concepts/02-Key_Dataflows.html">How Data Moves in AdTech</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02-Core_Concepts/03-Impressions_Clicks_Conversions.html">Important Numbers for Online Ads</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Chapter 3: Measurement Fundamentals</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01-Importance_of_Measurement.html">Why It’s Important to Measure (and Why It’s Harder Than You Think)</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Counting Impressions: Tags, Pixels, and Logs</a></li>

<li class="toctree-l2"><a class="reference internal" href="03-Measurement_Challenges.html">The Messy Truth About Measuring ROI</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../04-User_Identification/index.html">Chapter 4: User Identification</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../04-User_Identification/01-Cookies.html">Cookies (Not the Good Kind)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04-User_Identification/02-Crumbling_Cookies.html">The Great Cookie Flip-Flop (Chaos in Motion)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04-User_Identification/03-Alternative_IDs.html">Life After Cookies (Other Ways to Identify Yourself)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04-User_Identification/04-Device_vs_People.html">Device IDs vs. People IDs: Who Are We Even Following?</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 2 - Programmatic Advertising &amp; Data Activation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../05-Programmatic_Intro/index.html">Chapter 5: Introduction to Programmatic Advertising</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../05-Programmatic_Intro/01-What_is_Programmatic.html">What is Programmatic Advertising?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05-Programmatic_Intro/02-RTB.html">The Millisecond Auction: Bidding in Real Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05-Programmatic_Intro/03-Programmatic_Players.html">DSPs, SSPs, Ad Exchanges, and DMPs</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../06-Data_In_AdTech/index.html">Chapter 6: Data in AdTech</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../06-Data_In_AdTech/01-Data_Types.html">Data Types in AdTech (First, Second, and Third-Party)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06-Data_In_AdTech/02-DMPs.html">DMPs (Data Management Platforms) - The Old Guard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06-Data_In_AdTech/03-CDPs.html">CDPs (Customer Data Platforms)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06-Data_In_AdTech/04-Segmentation_Targeting.html">Targeting and Segmentation</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 3 - Modern Challenges &amp; Future Trends</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../07-Privacy_Regulation/index.html">Chapter 7: Privacy and Regulation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../07-Privacy_Regulation/01-Privacy_Concerns.html">Privacy Issues in AdTech</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07-Privacy_Regulation/02-Regulations.html">Privacy Rules (The Laws With Teeth)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07-Privacy_Regulation/03-CMPs.html">CMPs (Platforms for Managing Consent)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07-Privacy_Regulation/04-Privacy_by_Design.html">Privacy by Design in Action (Patterns for Engineers)</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../08-Programming_in_AdTech/index.html">Chapter 8: Programming in AdTech</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../08-Programming_in_AdTech/01-Introduction.html">Programming in AdTech</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08-Programming_in_AdTech/02-Adserver.html">Basic Ad Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08-Programming_in_AdTech/03-Header%20Bidding%20Basics.html">Header Bidding Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08-Programming_in_AdTech/04-Real%20Time%20Bidding.html">Real Time Bidding (RTB) Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08-Programming_in_AdTech/05-Creative%20AB%20Testing.html">Creative A/B Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08-Programming_in_AdTech/06-Deal%20IDs%20%26%20Private%20Marketplace%20%28PMP%29.html">Deal IDs &amp; Private Marketplace (PMP)</a></li>







<li class="toctree-l2"><a class="reference internal" href="../08-Programming_in_AdTech/07-Client%20%26%20Server%20Side%20Tagging.html">Client-Side vs Server-Side Tagging</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../09-AI_ML/index.html">AI &amp; Machine Learning in AdTech</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../09-AI_ML/01-AI_Applications.html">AI Applications in AdTech</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09-AI_ML/02-Algorithmic_Bidding.html">Algorithmic Bidding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09-AI_ML/03-Predictive_Analytics.html">Predictive Analytics in AdTech</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Conclusion.html">Conclusion: The AdTech Evolution Continues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix.html">Appendix: Resources, Tools &amp; Further Reading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../References.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/03-Measurement_Fundamentals/02-Counting_Impressions.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Counting Impressions: Tags, Pixels, and Logs</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Counting Impressions: Tags, Pixels, and Logs</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-actually-happens-when-you-count-impressions">What Actually Happens When You Count Impressions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#counting-methods">Counting Methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#server-side">1. Server Side</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#counting-on-the-client-side-the-standard">2. Counting on the Client Side (The Standard)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-use">How to use:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-pixel-that-tracks">The Pixel That Tracks</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-use-it">How to use it</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-measurement-solution-stack">The Measurement Solution Stack</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#important-points">Important Points</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="counting-impressions-tags-pixels-and-logs">
<h1>Counting Impressions: Tags, Pixels, and Logs<a class="headerlink" href="#counting-impressions-tags-pixels-and-logs" title="Link to this heading">#</a></h1>
<p>It seems easy to count things. You saw an ad, which is one impression. You clicked on it, which counts as one click. It does sound simple.</p>
<p>However, it’s really hard to count digital events. Bots make numbers bigger. Ad blockers stop them. Different systems count at different times and in different ways. Two platforms that measure the same campaign will give you different numbers, and both of them are right.</p>
<section id="what-actually-happens-when-you-count-impressions">
<h2>What Actually Happens When You Count Impressions<a class="headerlink" href="#what-actually-happens-when-you-count-impressions" title="Link to this heading">#</a></h2>
<p>When a person sees an ad, that counts as an impression or thats the way its usually supposed to work assuming perfect conditions.</p>
<section id="counting-methods">
<h3>Counting Methods<a class="headerlink" href="#counting-methods" title="Link to this heading">#</a></h3>
</section>
<section id="server-side">
<h3>1. Server Side<a class="headerlink" href="#server-side" title="Link to this heading">#</a></h3>
<p>The count of the time it takes for the ad server to send the creative to the publisher’s page.</p>
<p>User requests page → Publisher requests ad → Ad server delivers ad → COUNT +1</p>
<p><strong>Problem:</strong> The ad might run into issues and not be viewable. The user could close the tab, the page might not load or spin endlessly, or the JavaScript might have issues. Essentially we counted an impression that didn’t happen.</p>
<p><strong>Advantage:</strong> It’s easy and works well for the ad server. Not easy to block.</p>
</section>
<section id="counting-on-the-client-side-the-standard">
<h3>2. Counting on the Client Side (The Standard)<a class="headerlink" href="#counting-on-the-client-side-the-standard" title="Link to this heading">#</a></h3>
<p>Count when JavaScript says the ad has loaded in the browser.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="err">/** Simple impression tracking pixel </span>

<span class="kd">const</span><span class="w"> </span><span class="nx">pixel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Image</span><span class="p">();</span>
<span class="nx">pixel</span><span class="p">.</span><span class="nx">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`https://adserver.com/track?`</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="sb">`ad=</span><span class="si">${</span><span class="nx">adId</span><span class="si">}</span><span class="sb">&amp;`</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="sb">`campaign=</span><span class="si">${</span><span class="nx">campaignId</span><span class="si">}</span><span class="sb">&amp;`</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="sb">`timestamp=</span><span class="si">${</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>

<span class="c1">// Pixel loads = counted as an impression</span>
<span class="c1">// Fire when the ad is put into the DOM</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;ad-slot&quot;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;DOMNodeInserted&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s2">&quot;ad-creative&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">trackImpression</span><span class="p">(</span><span class="s1">&#39;ad_12345&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;campaign_67890&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p><strong>Problem:</strong> Tracking pixels are killed by ad blockers. People who close tabs quickly might not wait for the pixel to go off. Errors in JavaScript break everything.</p>
<p><strong>Advantage:</strong> This is more accurate since the ad made it to the browser.</p>
<ol class="arabic simple" start="3">
<li><p>Counting Based on Viewability (The Best)</p></li>
</ol>
<p>Count only when the ad is on the screen.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// Only track impressions that can be seen</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">trackViewableImpression</span><span class="p">(</span><span class="nx">adElement</span><span class="p">,</span><span class="w"> </span><span class="nx">adId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">observer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">IntersectionObserver</span><span class="p">((</span><span class="nx">entries</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">entries</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">entry</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">isIntersecting</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// The ad is at least 50% visible</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">visibilityRatio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">intersectionRatio</span><span class="p">;</span>
<span class="w">                </span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">visibilityRatio</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// Start the timer; we need one second of viewability</span>
<span class="w">                    </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="c1">// Check if it&#39;s still visible after 1 second</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">isIntersecting</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="nx">fireImpressionPixel</span><span class="p">(</span><span class="nx">adId</span><span class="p">);</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">},</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span>
<span class="w">                </span><span class="c1">// Stop watching after counting</span>
<span class="w">                </span><span class="nx">observer</span><span class="p">.</span><span class="nx">unobserve</span><span class="p">(</span><span class="nx">adElement</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">threshold</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">0.5</span><span class="p">]</span><span class="w"> </span><span class="c1">// Trigger when 50% visible</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span>
<span class="w">    </span><span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nx">adElement</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">fireImpressionPixel</span><span class="p">(</span><span class="nx">adId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`https://adserver.com/track`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<span class="w">            </span><span class="nx">ad_id</span><span class="o">:</span><span class="w"> </span><span class="nx">adId</span><span class="p">,</span>
<span class="w">            </span><span class="nx">viewable</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
<span class="w">        </span><span class="p">}),</span>
<span class="w">        </span><span class="nx">keepalive</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="how-to-use">
<h3>How to use:<a class="headerlink" href="#how-to-use" title="Link to this heading">#</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">adElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.ad-unit&#39;</span><span class="p">);</span>
<span class="nx">trackViewableImpression</span><span class="p">(</span><span class="nx">adElement</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ad_12345&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>IAB Viewability Standard:</strong></p>
<p>For display ads, at least 50% of the pixels must be in view for at least 1 second. For video ads, at least 50% of the pixels must be in view for at least 2 seconds.</p>
</section>
</section>
<section id="the-pixel-that-tracks">
<h2>The Pixel That Tracks<a class="headerlink" href="#the-pixel-that-tracks" title="Link to this heading">#</a></h2>
<p>AdTech’s most famous trick is the 1x1 pixel. It’s really just an image that looks like surveillance. Its notoriously used in emails to track if the email was opened.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- A typical tracking pixel --&gt;</span> <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://adserver.com/pixel.gif? campaign=123&amp; creative=456&amp; user=abc&amp; timestamp=1234567890&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;1&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;1&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;display:none;&quot;</span> <span class="p">/&gt;</span>
``

When the browser loads this &quot;image&quot; it sends a request to the ad server with all the query parameters. The server saves the data, sends back a small transparent GIF, and you&#39;ve tracked an impression.

**The modern version uses JavaScript instead:**

### How to use: 

```javascript

// More advanced tracking beacon
(function() {
    const data = {
        ad_id: &#39;ad_123&#39;,
        campaign_id: &#39;camp_456&#39;,
        user_id: getUserId(),
        page_url: window.location.href,
        referrer: document.referrer,
        screen_size: `${window.screen.width}x${window.screen.height}`,
        viewport_size: `${window.innerWidth}x${window.innerHeight}`,
        timestamp: Date.now()
    };
    
    // Send beacon (won&#39;t be blocked by page unload)
    navigator.sendBeacon(
        &#39;https://adserver.com/track&#39;,
        JSON.stringify(data)
    );
})();
</pre></div>
</div>
<p>navigator.sendBeacon() is meant for tracking; it works every time, even if the user closes the tab right away.</p>
<p>Server logs are the only place to get the truth.</p>
<p>There is a server logging the request behind every pixel. This is where people really count.</p>
<p>**Basic log entry:</p>
<p><code class="docutils literal notranslate"><span class="pre">2024-10-04</span> <span class="pre">15:23:45</span> <span class="pre">|</span> <span class="pre">ad_12345</span> <span class="pre">|</span> <span class="pre">campaign_67890</span> <span class="pre">|</span> <span class="pre">user_abc123</span> <span class="pre">|</span> <span class="pre">192.168.1.1</span> <span class="pre">|</span> <span class="pre">Mozilla/5.0...</span> <span class="pre">|</span> <span class="pre">viewed</span></code></p>
<p><strong>How to process these logs:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span> <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="k">def</span><span class="w"> </span><span class="nf">count_impressions</span><span class="p">(</span><span class="n">log_file</span><span class="p">):</span> <span class="s2">&quot;&quot;&quot; Count impressions from raw ad server logs &quot;&quot;&quot;</span>
    
    <span class="c1"># Read the log file logs = pd.read_csv(log_file, sep=&#39;|&#39;, names=[ &#39;timestamp&#39;, &#39;ad_id&#39;, &#39;campaign_id&#39;, &#39;user_id&#39;, &#39;ip_address&#39;, &#39;user_agent&#39;, &#39;event_type&#39; ])</span>
    
    <span class="c1"># Filter for events that show impressions (not clicks or other events)</span>
    <span class="n">impressions</span> <span class="o">=</span> <span class="n">logs</span><span class="p">[</span><span class="n">logs</span><span class="p">[</span><span class="s1">&#39;event_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;viewed&#39;</span>
    
    <span class="c1"># Remove duplicates (one impression for the same user and ad within an hour)</span>
    <span class="n">impressions</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">impressions</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
    <span class="n">impressions</span> <span class="o">=</span> <span class="n">impressions</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
    
    <span class="c1"># Group by user and ad, and only keep the first impression that happens within the time window.</span>
    <span class="n">impressions</span><span class="p">[</span><span class="s1">&#39;time_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">impressions</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;ad_id&#39;</span><span class="p">])[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="n">impressions</span> <span class="o">=</span> <span class="n">impressions</span><span class="p">(</span><span class="n">impressions</span><span class="p">[</span><span class="s1">&#39;time_diff&#39;</span><span class="p">]</span><span class="n">isna</span><span class="p">()</span> <span class="o">|</span> <span class="o">|</span>  <span class="c1"># First impression (impressions[&#39;time_diff&#39;] &gt; pd.Timedelta(hours=1))  # Or more than an hour since the last</span>
    
    <span class="c1"># Count how many impressions each campaign got impression_counts = impressions.groupby(&#39;campaign_id&#39;).size()</span>
    
    <span class="k">return</span> <span class="n">impression_counts</span>

<span class="c1"># Usage # counts = count_impressions(&#39;ad_server_logs.csv&#39;)</span>
<span class="c1"># print(counts)</span>

<span class="o">**</span><span class="n">Problems</span> <span class="k">with</span> <span class="n">counting</span> <span class="n">based</span> <span class="n">on</span> <span class="n">logs</span><span class="p">:</span><span class="o">**</span> <span class="mf">1.</span> <span class="o">**</span><span class="n">Bot</span> <span class="n">traffic</span><span class="p">:</span><span class="o">**</span> <span class="n">Bots</span> <span class="n">send</span> <span class="n">HTTP</span> <span class="n">requests</span> <span class="n">similar</span> <span class="n">to</span> <span class="n">normal</span> <span class="n">traffic</span><span class="o">.</span>
<span class="mf">2.</span> <span class="o">**</span><span class="n">Duplicate</span> <span class="n">requests</span><span class="p">:</span><span class="o">**</span> <span class="n">Network</span> <span class="n">retries</span> <span class="n">can</span> <span class="n">make</span> <span class="n">counts</span> <span class="n">go</span> <span class="n">up</span>
<span class="mf">3.</span> <span class="o">**</span><span class="n">Privacy</span><span class="p">:</span><span class="o">**</span> <span class="n">User</span> <span class="n">agents</span> <span class="ow">and</span> <span class="n">IP</span> <span class="n">addresses</span> <span class="n">are</span> <span class="n">now</span> <span class="n">private</span> <span class="n">information</span><span class="o">.</span> 
<span class="mf">4.</span> <span class="o">**</span><span class="n">Scale</span><span class="p">:</span><span class="o">**</span> <span class="n">Big</span> <span class="n">campaigns</span> <span class="n">make</span> <span class="n">millions</span> <span class="n">of</span> <span class="n">log</span> <span class="n">entries</span> <span class="n">every</span> <span class="n">hour</span><span class="o">.</span>

<span class="c1">## Why the Numbers Never Match</span>

<span class="n">You</span> <span class="n">run</span> <span class="n">a</span> <span class="n">campaign</span><span class="o">.</span> <span class="n">According</span> <span class="n">to</span> <span class="n">Google</span> <span class="n">Analytics</span><span class="p">,</span> <span class="n">there</span> <span class="n">were</span> <span class="mi">50</span><span class="p">,</span><span class="mi">000</span> <span class="n">views</span><span class="o">.</span> <span class="n">Your</span> <span class="n">ad</span> <span class="n">server</span> <span class="n">says</span> <span class="mi">48</span><span class="p">,</span><span class="mf">000.</span> <span class="n">The</span> <span class="n">publisher</span> <span class="n">says</span> <span class="mi">52</span><span class="p">,</span><span class="mf">000.</span> <span class="n">Who</span> <span class="ow">is</span> <span class="n">right</span><span class="err">?</span>

<span class="n">Everyone</span><span class="o">.</span> <span class="n">And</span> <span class="n">no</span> <span class="n">one</span><span class="o">.</span> 

<span class="o">**</span><span class="n">Why</span> <span class="n">there</span> <span class="n">are</span> <span class="n">differences</span><span class="p">:</span><span class="o">**</span>

<span class="mf">1.</span> <span class="n">Different</span> <span class="n">ways</span> <span class="n">of</span> <span class="n">counting</span>
<span class="o">-</span> <span class="n">The</span> <span class="n">ad</span> <span class="n">server</span> <span class="n">counts</span> <span class="n">when</span> <span class="n">it</span> <span class="n">serves</span> <span class="n">the</span> <span class="n">ad</span><span class="o">.</span> <span class="o">-</span> <span class="n">The</span> <span class="n">publisher</span> <span class="n">counts</span> <span class="n">when</span> <span class="n">the</span> <span class="n">ad</span> <span class="n">shows</span> <span class="n">up</span> <span class="n">on</span> <span class="n">their</span> <span class="n">page</span><span class="o">.</span> <span class="o">-</span> <span class="n">The</span> <span class="n">analytics</span> <span class="n">counts</span> <span class="n">when</span> <span class="n">the</span> <span class="n">tracking</span> <span class="n">JavaScript</span> <span class="n">loads</span><span class="o">.</span>

<span class="o">**</span><span class="mf">2.</span> <span class="n">Blockers</span> <span class="n">of</span> <span class="n">Ads</span><span class="o">**</span>
<span class="o">-</span> <span class="n">More</span> <span class="n">often</span> <span class="n">than</span> <span class="n">ad</span> <span class="n">serving</span><span class="p">,</span> <span class="n">analytics</span> <span class="n">tracking</span> <span class="n">gets</span> <span class="n">blocked</span><span class="o">.</span> <span class="o">-</span> <span class="n">Some</span> <span class="n">users</span> <span class="n">see</span> <span class="n">ads</span><span class="p">,</span> <span class="n">but</span> <span class="n">tracking</span> <span class="n">never</span> <span class="n">fires</span><span class="o">.</span>

<span class="o">**</span><span class="mf">3.</span> <span class="n">Problems</span> <span class="k">with</span> <span class="n">technology</span><span class="o">**</span>
<span class="o">-</span> <span class="n">Tracking</span> <span class="n">doesn</span><span class="s1">&#39;t work because of JavaScript errors - Tracking times out because pages load slowly - Request failures happen because of network problems</span>

<span class="mf">4.</span> <span class="n">Logic</span> <span class="k">for</span> <span class="n">removing</span> <span class="n">duplicates</span>
<span class="o">-</span> <span class="n">Different</span> <span class="n">systems</span> <span class="n">have</span> <span class="n">different</span> <span class="n">rules</span> <span class="n">about</span> <span class="n">what</span> <span class="n">makes</span> <span class="n">something</span> <span class="n">unique</span><span class="o">.</span>
<span class="o">-</span> <span class="n">The</span> <span class="n">time</span> <span class="n">windows</span> <span class="n">are</span> <span class="n">different</span> <span class="p">(</span><span class="n">hourly</span><span class="p">,</span> <span class="n">daily</span><span class="p">,</span> <span class="ow">or</span> <span class="n">the</span> <span class="n">whole</span> <span class="n">campaign</span><span class="p">)</span>

<span class="o">**</span><span class="mf">5.</span> <span class="n">Filtering</span> <span class="n">Bots</span><span class="o">**</span>
<span class="o">-</span> <span class="n">Each</span> <span class="n">platform</span> <span class="n">has</span> <span class="n">its</span> <span class="n">own</span> <span class="n">way</span> <span class="n">of</span> <span class="n">finding</span> <span class="n">bots</span><span class="o">.</span> <span class="n">Some</span> <span class="nb">filter</span> <span class="n">a</span> <span class="n">lot</span><span class="p">,</span> <span class="k">while</span> <span class="n">others</span> <span class="n">don</span><span class="s1">&#39;t filter at all.</span>

<span class="o">**</span><span class="n">Normal</span> <span class="nb">range</span> <span class="n">of</span> <span class="n">differences</span><span class="p">:</span><span class="o">**</span> <span class="mi">5</span><span class="err">–</span><span class="mi">15</span><span class="o">%</span> <span class="ow">is</span> <span class="n">usually</span> <span class="n">normal</span><span class="o">.</span> 

<span class="c1">## Fraud: The Counting Issue </span>

<span class="n">Fake</span> <span class="n">impressions</span> <span class="n">waste</span> <span class="n">billions</span> <span class="n">of</span> <span class="n">dollars</span> <span class="n">on</span> <span class="n">ads</span><span class="o">.</span> <span class="n">Sophisticated</span> <span class="n">bot</span> <span class="n">networks</span> <span class="n">act</span> <span class="n">like</span> <span class="n">people</span><span class="p">,</span> <span class="n">which</span> <span class="n">makes</span> <span class="n">it</span> <span class="n">almost</span> <span class="n">impossible</span> <span class="n">to</span> <span class="n">find</span> <span class="n">fraud</span> <span class="n">on</span> <span class="n">a</span> <span class="n">large</span> <span class="n">scale</span><span class="o">.</span>

<span class="o">**</span><span class="n">Different</span> <span class="n">types</span> <span class="n">of</span> <span class="n">impression</span> <span class="n">fraud</span><span class="p">:</span><span class="o">**</span>

<span class="o">**</span><span class="mf">1.</span> <span class="n">Bot</span> <span class="n">Traffic</span><span class="o">**</span> <span class="n">Scripts</span> <span class="n">that</span> <span class="n">run</span> <span class="n">automatically</span> <span class="ow">and</span> <span class="n">load</span> <span class="n">pages</span><span class="p">,</span> <span class="n">view</span> <span class="n">ads</span><span class="p">,</span> <span class="ow">and</span> <span class="n">even</span> <span class="n">make</span> <span class="n">mouse</span> <span class="n">movements</span> <span class="ow">and</span> <span class="n">clicks</span><span class="o">.</span>

<span class="o">**</span><span class="mf">2.</span> <span class="n">Stacking</span> <span class="n">Ads</span><span class="o">**</span>
<span class="n">There</span> <span class="n">are</span> <span class="n">a</span> <span class="n">lot</span> <span class="n">of</span> <span class="n">ads</span> <span class="n">stacked</span> <span class="n">on</span> <span class="n">top</span> <span class="n">of</span> <span class="n">each</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">same</span> <span class="n">place</span><span class="o">.</span> <span class="n">People</span> <span class="n">can</span> <span class="n">only</span> <span class="n">see</span> <span class="n">the</span> <span class="n">topmost</span> <span class="n">ad</span><span class="p">,</span> <span class="n">but</span> <span class="nb">all</span> <span class="n">of</span> <span class="n">them</span> <span class="n">get</span> <span class="n">counted</span> <span class="k">as</span> <span class="n">impressions</span><span class="o">.</span>

<span class="o">**</span><span class="mf">3.</span> <span class="n">Stuffing</span> <span class="n">Pixels</span>
<span class="n">Putting</span> <span class="n">ads</span> <span class="ow">in</span> <span class="n">frames</span> <span class="n">that</span> <span class="n">are</span> <span class="mi">1</span><span class="n">x1</span> <span class="n">pixels</span><span class="o">.</span> <span class="s2">&quot;Delivered&quot;</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">technical</span> <span class="n">sense</span><span class="p">,</span> <span class="n">but</span> <span class="ow">not</span> <span class="n">seen</span> <span class="n">by</span> <span class="n">people</span><span class="o">.</span>

<span class="mf">4.</span> <span class="n">Domain</span> <span class="n">Spoofing</span>
<span class="n">Scammers</span> <span class="n">say</span> <span class="n">that</span> <span class="n">their</span> <span class="n">low</span><span class="o">-</span><span class="n">quality</span> <span class="n">site</span> <span class="ow">is</span> <span class="n">actually</span> <span class="n">a</span> <span class="n">premium</span> <span class="n">publisher</span> <span class="n">so</span> <span class="n">they</span> <span class="n">can</span> <span class="n">charge</span> <span class="n">higher</span> <span class="n">CPMs</span><span class="o">.</span>

<span class="o">**</span><span class="n">Basic</span> <span class="n">fraud</span> <span class="n">detection</span><span class="p">:</span><span class="o">**</span>

<span class="err">```</span><span class="n">python</span> 

<span class="k">def</span><span class="w"> </span><span class="nf">detect_suspicious_traffic</span><span class="p">(</span><span class="n">impression_logs</span><span class="p">):</span> 
    
    <span class="n">suspicious</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">impression_logs</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span> <span class="n">flags</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Too many impressions coming from one IP</span>
        <span class="n">ip_count</span> <span class="o">=</span> <span class="n">impression_logs</span><span class="p">[</span><span class="n">impression_logs</span><span class="p">[</span><span class="s1">&#39;ip_address&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;ip_address&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ip_count</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span> <span class="n">flags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;high_ip_frequency&#39;</span><span class="p">)</span>
        
        <span class="c1"># The user agent is a bot that is known</span>
        <span class="n">bot_keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bot&#39;</span><span class="p">,</span> <span class="s1">&#39;crawler&#39;</span><span class="p">,</span> <span class="s1">&#39;spider&#39;</span><span class="p">,</span> <span class="s1">&#39;scraper&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">keyword</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;user_agent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">each</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">bot_keywords</span><span class="p">):</span> <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;bot_user_agent&#39;</span><span class="p">)</span>
        
        <span class="c1"># Impression duration not realistic (too fast or too slow)</span>
        <span class="k">if</span> <span class="s2">&quot;session_duration&quot;</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">row</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;session_duration&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;impossible_speed&quot;</span><span class="p">)</span>
        
        <span class="c1"># Patterns of engagement (no mouse movement, no scrolling)</span>
        <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mouse_events&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scroll_events&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">flags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;no_engagement&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">there</span> <span class="n">are</span> <span class="n">flags</span><span class="p">,</span> <span class="n">something</span> <span class="ow">is</span> <span class="n">wrong</span><span class="o">.</span><span class="n">append</span><span class="p">({</span> <span class="s1">&#39;impression_id&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;impression_id&#39;</span><span class="p">],</span> <span class="s1">&#39;flags&#39;</span><span class="p">:</span> <span class="n">flags</span><span class="p">,</span> <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span> <span class="c1"># Simple confidence score })</span>
    
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">suspicious</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="how-to-use-it">
<h1>How to use it<a class="headerlink" href="#how-to-use-it" title="Link to this heading">#</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">suspicious_traffic</span> <span class="o">=</span> <span class="n">detect_suspicious_traffic</span><span class="p">(</span><span class="n">logs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Flagged </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">suspicious_traffic</span><span class="p">)</span><span class="si">}</span><span class="s2"> suspicious impressions&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Real fraud detection is a lot more complicated (ML models, device fingerprinting, behavioral analysis), but the idea is the same: look for patterns that don’t fit with how people normally act.</p>
<section id="the-measurement-solution-stack">
<h2>The Measurement Solution Stack<a class="headerlink" href="#the-measurement-solution-stack" title="Link to this heading">#</a></h2>
<p>Counting impressions accurately means that several systems work together:</p>
<ol class="arabic simple">
<li><p><strong>Ad Server</strong>: Shows ads and counts impressions on the server side. 2. <strong>Tag Manager</strong>: Puts tracking pixels on your site.</p></li>
<li><p><strong>Platform for Analytics</strong> - Keeps track of how users act and checks that they see ads</p></li>
<li><p><strong>Viewability Vendor</strong> - Checks to see if people actually saw the ads (IAS, Moat, DoubleVerify)</p></li>
<li><p><strong>Finding Fraud</strong> - Stops bot traffic (White Ops, Forensiq)</p></li>
</ol>
<p>Each one adds a layer of validation and takes a cut. It costs a lot to measure things correctly.</p>
</section>
<section id="important-points">
<h2>Important Points<a class="headerlink" href="#important-points" title="Link to this heading">#</a></h2>
<p>Counting impressions looks easy, but there are a lot of different ways to do it, like server-side, client-side, and viewability-based.</p>
<ul class="simple">
<li><p>Balancing simplicity and accuracy - Big differences between platforms (5–15% is normal)</p></li>
<li><p>Always fighting fraud</p></li>
</ul>
<p>There is no one-size-fits-all way to measure things. The best you can do is know what your limits are, use the same methods every time, and check your numbers often.</p>
<p>Always ask, “How are you counting?” when someone tells you how many impressions they have. The answer is more important than the number itself.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./03-Measurement_Fundamentals"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="01-Importance_of_Measurement.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Why It’s Important to Measure (and Why It’s Harder Than You Think)</p>
      </div>
    </a>
    <a class="right-next"
       href="03-Measurement_Challenges.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">The Messy Truth About Measuring ROI</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Counting Impressions: Tags, Pixels, and Logs</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-actually-happens-when-you-count-impressions">What Actually Happens When You Count Impressions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#counting-methods">Counting Methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#server-side">1. Server Side</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#counting-on-the-client-side-the-standard">2. Counting on the Client Side (The Standard)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-use">How to use:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-pixel-that-tracks">The Pixel That Tracks</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-use-it">How to use it</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-measurement-solution-stack">The Measurement Solution Stack</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#important-points">Important Points</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Vishwanath Subramanian
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright © 2025 CC BY-NC 4.0..
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>